# config/tasks.yaml
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§  ê° Agentê°€ ìˆ˜í–‰í•  Task ì •ì˜
# CrewAIì˜ Task ê°ì²´ë¡œ ë³€í™˜ë˜ì–´ ì‹¤í–‰ë¨
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# 1ï¸âƒ£ ë‰´ìŠ¤ ìˆ˜ì§‘ê¸° (Collector)
rss_scheduled_collect_task:
  description: >
    {rss_feeds}ì—ì„œ ìµœê·¼ {hours}ì‹œê°„ ê¸°ì‚¬ë¥¼ ìˆ˜ì§‘í•´ DBì— upsertí•œë‹¤.
    ê·œì¹™:
    - ê¸°ì‚¬ í˜ì´ì§€ ì•„ë‹Œ /tag|/topic|/hub|/section|/category/ íŒ¨í„´ì€ ì œì™¸
    - extract_article_content ì‹¤íŒ¨/ë³¸ë¬¸<300ìë©´ scrape_toolë¡œ í´ë°± í›„ ì¬íŒŒì‹±
    - url/canonical/hashë¡œ ì¤‘ë³µ ìŠ¤í‚µ â†’ ì„ë² ë”© ë¯¸ë³´ìœ  ê¸°ì‚¬ë§Œ ì„ë² ë”©
    - ìµœê·¼ {hours}ì‹œê°„ ë²”ìœ„ì—ì„œ í´ëŸ¬ìŠ¤í„° ê°±ì‹  í›„ ìƒìœ„ {top_k} ì´ë²¤íŠ¸ë¡œ ë³´ê³ ì„œ({report_format}) ìƒì„±
    - reports(scope='scheduled', source='rss', params=ìœˆë„ìš°/í”¼ë“œ)ë¡œ ì €ì¥
  expected_output: >
    {"feeds_processed":int,"articles_collected":int,"articles_embedded":int,"events_updated":int,"report_id":int|null}
  agent: rss_collector_agent
  inputs:
    rss_feeds: []
    hours: 6
    top_k: 10
    report_format: md

serper_ad_hoc_collect_task:
  description: >
    {query}ë¡œ Serper ê²€ìƒ‰ {n_results}ê±´ ìˆ˜ì§‘ â†’ ê¸°ì‚¬ë§Œ ì„ ë³„ â†’ ë³¸ë¬¸ í™•ë³´ â†’ upsert/ì„ë² ë”© â†’ í´ëŸ¬ìŠ¤í„° ì—°ê²°/ìƒì„±.
    {make_report}ë©´ ë³´ê³ ì„œ({report_format}) ìƒì„±í•˜ì—¬ reports(scope='ad_hoc', source='serper', params=ì§ˆì˜) ì €ì¥.
  expected_output: >
    {"query":str,"articles_collected":int,"articles_embedded":int,"events_touched":int,"report_id":int|null}
  agent: serper_collector_agent
  inputs:
    query: ""
    n_results: 20
    cluster_threshold: 0.25
    make_report: true
    report_format: md
    allow_all_langs: false
agent: collector

collect_news_task:
  description: >
    RSS í”¼ë“œì—ì„œ ë‰´ìŠ¤ë¥¼ ìˆ˜ì§‘í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤.
    
    **ë‹¨ê³„:**
    1. ì§€ì •ëœ RSS í”¼ë“œ URLë“¤ì—ì„œ ìµœì‹  ê¸°ì‚¬ URLì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
    2. ê° URLì„ ë°©ë¬¸í•˜ì—¬ ê¸°ì‚¬ ë³¸ë¬¸ì„ ìŠ¤í¬ë˜í•‘í•©ë‹ˆë‹¤.
    3. ìˆ˜ì§‘ëœ ê¸°ì‚¬ë“¤ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤.
    4. ì €ì¥ ê²°ê³¼ì™€ ê¸°ì‚¬ IDë“¤ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
  expected_output: >
    ìˆ˜ì§‘ ë° ì €ì¥ ê²°ê³¼ ìš”ì•½ (ê°€ì ¸ì˜¨ ê¸°ì‚¬ ìˆ˜, ì €ì¥ëœ ê¸°ì‚¬ ìˆ˜, ì„ë² ë”© ëŒ€ìƒ ID ëª©ë¡)
  agent: rss_collector_agent

# 2ï¸âƒ£ ê¸°ì‚¬ ì„ë² ë” (Embedder)
embed_articles_task:
  description: >
    ìˆ˜ì§‘ëœ ê° ê¸°ì‚¬ì— ëŒ€í•´ OpenAI ì„ë² ë”© API
    (ì˜ˆ: text-embedding-3-small ë˜ëŠ” large)ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ ì„ë² ë”© ë²¡í„°ë¥¼ ìƒì„±í•˜ê³ ,
    í•´ë‹¹ ë²¡í„°ë¥¼ PostgreSQL(pgvector) ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤.

    **ë‹¨ê³„:**
    1. ê° ê¸°ì‚¬ì— ëŒ€í•´ ì œëª© + ë³¸ë¬¸ í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„ë² ë”©ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
    2. `article_embeddings` í…Œì´ë¸”ì— ì„ë² ë”©ì„ ì‚½ì…í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    3. ì €ì¥ëœ ì„ë² ë”© ìˆ˜ì— ëŒ€í•œ ìš”ì•½ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
  expected_output: >
    ìš”ì•½ JSON: {"num_embeddings_stored": int, "model_used": str}
  agent: embedder

# 3ï¸âƒ£ ì‚¬ê±´ í´ëŸ¬ìŠ¤í„°ë§ (Clusterer)
cluster_events_task:
  description: >
    ì˜ë¯¸ì ìœ¼ë¡œ ìœ ì‚¬í•œ ê¸°ì‚¬ë“¤ì„ ì‚¬ê±´ ë‹¨ìœ„ ê·¸ë£¹ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ë§í•©ë‹ˆë‹¤.
    í´ëŸ¬ìŠ¤í„°ë§ ê¸°ì¤€ì€ ì„ë² ë”©ê³¼ ë©”íƒ€ë°ì´í„°(ì˜ˆ: ì‹œê°„, í‚¤ì›Œë“œ, ì¶œì²˜ ë“±)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

    **ë‹¨ê³„:**
    1. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìµœê·¼ ê¸°ì‚¬ ì„ë² ë”©ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
    2. í´ëŸ¬ìŠ¤í„°ë§ ìˆ˜í–‰ (ì˜ˆ: ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ì„ê³„ê°’ 0.85).
    3. `events` í…Œì´ë¸”ì— ì‚¬ê±´ ë ˆì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    4. ê° ê¸°ì‚¬ë¥¼ í•´ë‹¹ ì‚¬ê±´ì— ì—°ê²°í•˜ì—¬ `event_articles` í…Œì´ë¸”ì— ê¸°ë¡í•©ë‹ˆë‹¤.
  expected_output: >
    `EventList` ìŠ¤í‚¤ë§ˆì™€ ì¼ì¹˜í•˜ëŠ” JSON ê°ì²´
  agent: clusterer

# 4ï¸âƒ£ ì‚¬ê±´ ë¦¬í¬í„° (Reporter)
generate_report_task:
  description: >
    ê° ì‚¬ê±´ì— ëŒ€í•œ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ ìš”ì•½ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.
    ë‹¤ìŒ í•­ëª©ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
    - ì‚¬ê±´ ìš”ì•½ (2~3ë¬¸ì¥)
    - ì£¼ìš” ì£¼ì œ/íƒœê·¸
    - í•µì‹¬ ê¸°ì‚¬ ì¶œì²˜ (ì œëª© + ì–¸ë¡ ì‚¬)
    - ê´€ë ¨ì´ ìˆë‹¤ë©´ ê²½ì œì  ë˜ëŠ” ì§€ì •í•™ì  í•¨ì˜

    **ë‹¨ê³„:**
    1. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ê±´ ë°ì´í„° ë° ì—°ê²°ëœ ê¸°ì‚¬ë“¤ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
    2. ì¼ê´€ì„± ìˆëŠ” ìš”ì•½ì„ ìƒì„±í•©ë‹ˆë‹¤.
    3. ê²°ê³¼ë¥¼ `reports` í…Œì´ë¸”ì— ì €ì¥í•©ë‹ˆë‹¤ (í˜•ì‹='md').
  expected_output: >
    `Report` ìŠ¤í‚¤ë§ˆì™€ ì¼ì¹˜í•˜ëŠ” JSON ê°ì²´
  agent: reporter
